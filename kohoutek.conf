<Directory /srv/kohoutek>
Require all denied

<Files "run.wsgi">
Require all granted
</Files>
</Directory>

<Directory /srv/kohoutek/site/static>
Require all granted
</Directory>

<Directory /srv/kohoutek/holding>
Require all granted
</Directory>

<VirtualHost *:80>
ServerName staging.kohoutek.co.uk

RewriteEngine on
RewriteCond %{HTTPS} off
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<VirtualHost *:443>
ServerName staging.kohoutek.co.uk

Include /etc/httpd/conf.d/includes/ssl-mozillla.conf
SSLCertificateFile /etc/letsencrypt/live/kohoutek.co.uk/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/kohoutek.co.uk/privkey.pem

DocumentRoot "/srv/kohoutek/holding"
</VirtualHost>

<VirtualHost *:80>
ServerName kohoutek.co.uk

RewriteEngine on
RewriteCond %{HTTPS} off
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<VirtualHost *:443>
ServerName kohoutek.co.uk

Include /etc/httpd/conf.d/includes/ssl-mozillla.conf
SSLCertificateFile /etc/letsencrypt/live/kohoutek.co.uk/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/kohoutek.co.uk/privkey.pem

Alias /static /srv/kohoutek/site/static
WSGIScriptAlias / /srv/kohoutek/site/run.wsgi

WSGIDaemonProcess kohoutek \
			  user=kohoutek \
			  group=kohoutek \
			  processes=5 \
			  threads=10 \
			  home=/srv/kohoutek/site \
			  python-home=/srv/kohoutek/site/.venv \
			  display-name='%{GROUP}' \
			  queue-timeout=45 \
			  socket-timeout=60 \
			  connect-timeout=15 \
			  request-timeout=60 \
			  inactivity-timeout=0 \
			  startup-timeout=15 \
			  deadlock-timeout=60 \
			  graceful-timeout=15 \
			  eviction-timeout=0 \
			  restart-interval=0 \
			  shutdown-timeout=5 \
			  maximum-requests=0


WSGIProcessGroup kohoutek
WSGIApplicationGroup kohoutek
</VirtualHost>
