{% extends "portal/orders/make_payment.jinja" %}
{% block name %}Online Payment{% endblock %}
{% block headjs %}<script src="https://js.stripe.com/v3/"></script>{% endblock %}
{% block bodyjs %}
<script type="text/javascript">
  var stripe = Stripe('{{ stripe_key }}');
  var button = document.getElementById('checkout');

  button.addEventListener('click', function() {
    fetch('{{ url_for("orders.stripeGenerateCheckout", id=order.id) }}', {
      method: 'POST',
      headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
      body: 'csrf_token={{ csrf_token() }}'
    })
    .then(function(response) {
      return response.json();
    })
    .then(function(session) {
      return stripe.redirectToCheckout({ sessionId: session.id });
    })
    .then(function(result) {
      if (result.error) {
        alert(result.error.message);
      }
    })
    .catch(function(error) {
      console.error('Error:', error);
    });
  });
</script>
{% endblock %}
{% block instructions %}
<p>We use Stripe as our online payment provider. On the Stripe checkout page you can check your order details, and provide an email address for a payment receipt.</p>

<div class="uk-text-center">
  <button id="checkout" class="uk-button uk-button-primary uk-button-large">Stripe Checkout</button>
</div>
{% endblock %}
